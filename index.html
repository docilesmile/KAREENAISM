<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>KAREENAISM Task Spinner</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #eee;
      text-align: center;
      padding: 20px;
    }
    input, button {
      padding: 10px;
      margin: 5px;
      border-radius: 5px;
      border: none;
      font-size: 16px;
    }
    button {
      background: #e91e63;
      color: white;
      cursor: pointer;
    }
    button:disabled {
      background: #555;
      cursor: not-allowed;
    }
    .task { margin: 5px 0; }
    .done { text-decoration: line-through; color: gray; }
  </style>
</head>
<body>
  <h1>Praise Goddess KAREENA!</h1>

  <!-- Login -->
  <form id="loginForm" onsubmit="return false;">
    <input type="email" id="email" placeholder="Email" autocomplete="username">
    <input type="password" id="password" placeholder="Password" autocomplete="current-password">
    <button id="login">Login</button>
  </form>
  <button id="logout" style="display:none;">Logout</button>

  <hr>

  <!-- Modules -->
  <div id="modulesContainer">Loading Modules from Goddess KAREENA's will...</div>

  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";

    const supabaseUrl = "https://djdhtdrseqfaiskvbvhb.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRqZGh0ZHJzZXFmYWlza3ZidmhiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYyODEyNDMsImV4cCI6MjA3MTg1NzI0M30.sLHzX-UMZfjp5cWn0ii3nDUI9jmxGt5SigOI7jEg_ew";
    const supabase = createClient(supabaseUrl, supabaseKey);

    const emailInput = document.getElementById("email");
    const passwordInput = document.getElementById("password");
    const loginBtn = document.getElementById("login");
    const logoutBtn = document.getElementById("logout");

    let currentUser = null;
    window.currentUser = null;

    // Login
    loginBtn.addEventListener("click", async () => {
      const { data, error } = await supabase.auth.signInWithPassword({
        email: emailInput.value,
        password: passwordInput.value
      });
      if (error) return alert(error.message);

      currentUser = data.user;
      window.currentUser = currentUser;

      loginBtn.style.display = "none";
      logoutBtn.style.display = "inline-block";

      // Dynamically load modules
      const { loadHolyDayStatusModule } = await import('./holyDayStatusModule.js');
      loadHolyDayStatusModule(supabase);

      const { loadTasksModule } = await import('./tasksModule.js');
      loadTasksModule(supabase); // beg-for-release now handled inside tasksModule

      const { loadChastityModule } = await import('./chastityModule.js');
      await loadChastityModule(supabase);
    });

    // Logout
    logoutBtn.addEventListener("click", async () => {
      await supabase.auth.signOut();
      currentUser = null;
      window.currentUser = null;

      loginBtn.style.display = "inline-block";
      logoutBtn.style.display = "none";

      document.getElementById("modulesContainer").innerHTML = "Loading Modules from Goddess KAREENA's will...";
    });
  </script>
</body>
</html>
