<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KAREENAISM Task Spinner</title>
<style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 50px; background: #f5f5f5; }
    #taskList { font-size: 1.1em; margin: 20px; text-align: left; display: inline-block; min-height: 60px; }
    .taskItem { margin-bottom: 10px; }
    .completed { text-decoration: line-through; color: #999; }
    .highlight { background-color: #fff8b0; padding: 3px; border-radius: 3px; } 
    button { padding: 10px 20px; font-size: 1em; margin: 5px; }
    .disabled { background: #ccc; color: #666; cursor: not-allowed; }
</style>
</head>
<body>

<h1>KAREENAISM Task Spinner</h1>
<p id="message">Loading tasks...</p>
<div id="taskList"></div>
<button id="nextTask" class="disabled" disabled>Get Task</button>
<button id="releaseBtn" class="disabled" disabled>Beg for Release</button>

<script>
const jsonURL = "gistfile1.json"; // Your JSON file in the same repo
let tasks = [];
let completedTasks = [];

// Load JSON tasks
async function loadTasks() {
    try {
        const response = await fetch(jsonURL);
        if (!response.ok) throw new Error("Network response was not ok");
        tasks = await response.json();
        console.log("Loaded tasks:", tasks); // Debug: ensure tasks loaded
        document.getElementById('message').textContent = "Tasks loaded! Click 'Get Task' to start.";
        document.getElementById('nextTask').disabled = false;
        document.getElementById('nextTask').classList.remove('disabled');
    } catch (error) {
        document.getElementById('message').textContent = "Error loading tasks. Check your URL and console.";
        console.error("Error fetching tasks:", error);
    }
}

// Check if all tasks are completed
function checkCompletion() {
    const allChecked = completedTasks.every((_, i) => {
        const cb = document.getElementById(`task_${i}`);
        return cb && cb.checked;
    });
    if (allChecked && completedTasks.length > 0) {
        document.getElementById('releaseBtn').disabled = false;
        document.getElementById('releaseBtn').classList.remove('disabled');
        document.getElementById('message').textContent = "You may now beg for release!";
    } else {
        document.getElementById('releaseBtn').disabled = true;
        document.getElementById('releaseBtn').classList.add('disabled');
        document.getElementById('message').textContent = "";
    }
}

// Generate random task
function getRandomTask() {
    if (tasks.length === 0) {
        document.getElementById('message').textContent = "No more tasks available.";
        return;
    }

    const index = Math.floor(Math.random() * tasks.length);
    const task = tasks[index];
    completedTasks.push({ text: task, done: false });
    tasks.splice(index, 1); // remove from available tasks

    // Remove previous highlight
    document.querySelectorAll('.highlight').forEach(el => el.classList.remove('highlight'));

    // Create task element with checkbox
    const taskDiv = document.createElement('div');
    taskDiv.className = 'taskItem highlight';

    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.id = `task_${completedTasks.length - 1}`;

    const label = document.createElement('label');
    label.htmlFor = checkbox.id;
    label.textContent = task;

    // Checkbox listener: strike-through + completion
    checkbox.addEventListener('change', function() {
        if (this.checked) {
            label.classList.add('completed');
            completedTasks[completedTasks.length - 1].done = true;
        } else {
            label.classList.remove('completed');
            completedTasks[completedTasks.length - 1].done = false;
        }
        checkCompletion();
    });

    taskDiv.appendChild(checkbox);
    taskDiv.appendChild(label);
    document.getElementById('taskList').appendChild(taskDiv);
}

// Event listeners
document.getElementById('nextTask').addEventListener('click', getRandomTask);
document.getElementById('releaseBtn').addEventListener('click', () => {
    alert("Begging for release! Only enabled after checking all tasks.");
});

// Load tasks on page load
loadTasks();
</script>

</body>
</html>
